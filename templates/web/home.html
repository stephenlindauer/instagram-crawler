<html>
<head>
<style>

body {
    font-family: HelveticaNeue;

}

#search-container {
    margin-top:20%;
    text-align: center;
    /*position: fixed;
    top:0;
    width:100%;
    background-color:white;*/
}

#search-container h1 {
    font-weight: 200;
    font-size:50px;
}

#search-textfield {
    padding:8px;
    font-size:18px;
    width:50%;
    min-width:300px;
    max-width:600px;
    border-radius: 8px;
    border:1px solid #CCC;
}

#search-help-text {
    font-size:14px;
    color: #999;
}

#search-results {
    margin-bottom:100px;
}

.account-row {
    margin-bottom:10px;
    clear:left;
    height:140px;
    padding:20px;
}

.account-row .account-avatar {
    float:left;
    width:140px;
    height:140px;
    margin-right:6px;
    margin-left:-20px;
    margin-top:-20px;
    margin-bottom:-20px;    

}

.account-row .account-username {
    font-size:22px;
    margin-bottom:14px;
}

.account-row .account-info {
    float:right;
    font-size:10px;
    text-align: center;
    padding:0 2px;
}

.account-row .account-info span {
    font-size:13px;
    font-weight: bold;
}

#result-meta {
    text-align: right;
    margin-bottom:20px;
}

#next-page-button {
    padding:14px;
    font-size:18px;
    display:block;
    width:50%;
    max-width:400px;
    text-align: center;
    margin: 0 auto;
    border: 1px solid #CCC;
    border-radius: 8px;
}

</style>
</head>
<body>

<div id='search-container'>
    
    <h1>Instagram Search</h1>
    <form id='search-form'>
    <input type='text' id='search-textfield' placeholder="Search">
    <div id='search-help-text'>Type your search terms above separated by commas. Enter to search.</div>
    </form>

</div>

<div id='search-results'></div>

<script src="https://nightlife2-webapp.s3.amazonaws.com/web2.0/js/libs/jquery-1.7.2.min.js"></script>

<script>

$(function() {

    $("#search-textfield").focus();

    $("#search-form").on("submit", function() {
        $("#search-results").html("Loading...");
        _page = 0;
        fetchResults(0);

        return false;
    });

});

var _page = 0;
var _accounts = [];

function fetchResults(page) {
    $.ajax({
        url:"/s?p=" + page + "&q=" + $("#search-textfield").val(),
        dataType: "json",
        success:function(data) {

            // Animate moving search bar to top of page
            $("#search-container").animate({
                marginTop:0
            });

            meta_html = "Showing " + (_accounts.length + data["results"].length) + " of " + data["meta"]["count"] + ".";
            if (_page == 0) {
                $("#search-results").html("");
                $("#search-results").append("<div id='result-meta'>"+meta_html+"</div>");
            }
            else {
                $("#result-meta").html(meta_html);

                // Scroll
                $("html, body").animate({ scrollTop: $(window).scrollTop() + 500 + "px" });
            }

            for (var i=0; i<data["results"].length; i++) {
                account = data["results"][i];

                _accounts.push(account);

                var elId = "account" + account.account_id;
                $("#search-results").append("<div class='account-row' id='"+elId+"'></div>");
                $("#"+elId).append("<img class='account-avatar' onerror='this.src=\"http://www.fm-base.co.uk/forum/attachments/football-manager-2014-manager-stories/618828d1403554937-ups-downs-building-one-default_original_profile_pic.png\"' src='" + account.avatar_url + "' />");
                $("#"+elId).append("<div class='account-info'><span>" + account.follower_count + "</span><br />following</div>");
                $("#"+elId).append("<div class='account-info'><span>" + account.followed_by_count + "</span><br />followers</div>");
                $("#"+elId).append("<div class='account-username'><a href='http://instagram.com/" + account.username + "'>" + account.username + "</a></div>");
                
                $("#"+elId).append("<div class='account-bio'>" + account.bio + "</div>");
            }

            $("#search-results").append("<a href='javascript:;' id='next-page-button'>More Results</a>");
            $("#next-page-button").on("click", function() {
                loadNextPage();
            });
        },
        error:function(a,b,c) {
            console.log(a);
            console.log(b);
            console.log(c);
            alert("Error");
        }
    });
}

function loadNextPage() {
    _page += 1;
    $("#next-page-button").remove();
    fetchResults(_page);
}

</script>
</body>
</html>